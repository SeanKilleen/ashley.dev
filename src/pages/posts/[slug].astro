---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Generate static paths for all posts
export async function getStaticPaths() {
  const blogEntries = await getCollection('posts');
  
  return blogEntries.map(entry => ({
    params: { slug: entry.data.slug || entry.slug },
    props: { entry },
  }));
}

// The entry prop is passed from getStaticPaths
const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <!-- Start: Main Wrapper -->
  <main class="flex flex-col w-full max-w-full md:max-w-7xl border border-gray-600 rounded-2xl overflow-hidden shadow-2xl relative bg-black mb-12 md:mb-4 mx-auto">
    
    <!-- Start: Content Area -->
    <div class="w-full p-0">
      <!-- Start: Inner wrapper -->
      <div class="min-h-full flex flex-col">
        
        <!-- Start: Header bar (similar to the tab bar in home) -->
        <div class="flex bg-black border-b border-gray-600 sticky top-0 z-10 p-4">
          <div class="flex-grow">
            <a href="/" class="px-3 py-1 border border-gray-600 rounded-lg hover:bg-gray-800 transition inline-block mb-4">
              &larr; Back to home
            </a>
            <h1 class="text-2xl font-bold">{entry.data.title}</h1>
          </div>
        </div>
        <!-- End: Header bar -->

        <!-- Start: Post content -->
        <div class="p-6 flex-grow overflow-y-auto bg-black">
          <article>
            <div class="flex flex-wrap items-center gap-2 mb-6">
              <p class="text-gray-400">{new Date(entry.data.date).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'})}</p>
              
              <!-- Tags display -->
              <div class="flex flex-wrap gap-1">
                {entry.data.tags?.map(tag => (
                  <span class="inline-block px-2 py-1 text-xs rounded-lg bg-black text-gray-100 cursor-pointer transition-all duration-150 border border-gray-600 hover:bg-primary hover:-translate-y-0.5 tag-link" data-tag={tag}>
                    #{tag}
                  </span>
                ))}
              </div>
            </div>
            
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
          </article>
        </div>
        <!-- End: Post content -->
        
      </div>
      <!-- End: Inner wrapper -->
    </div>
    <!-- End: Content Area -->
    
  </main>
  <!-- End: Main Wrapper -->
  
  <!-- Credits (matching home page) -->
  <div class="fixed md:absolute bottom-0 left-0 right-0 w-full text-center bg-black py-2">
    Built with <a href="https://astro.build" title="Astro" target="_blank" class="text-primary hover:underline">Astro</a> by <a href="https://ashley.dev/" target="_blank" title="ashley.dev" class="text-primary hover:underline">ashley.dev</a>
  </div>
</Layout>

<script>
  // Make tag spans clickable to filter
  document.addEventListener('DOMContentLoaded', () => {
    const tagLinks = document.querySelectorAll('.tag-link');
    
    tagLinks.forEach(link => {
      link.addEventListener('click', () => {
        // Extract tag name from the data attribute
        const tagName = link.getAttribute('data-tag');
        
        // Navigate back to homepage with tag as query parameter
        // This will allow us to activate the correct tab and filter
        window.location.href = `/?tab=blogs&tag=${tagName}`;
      });
    });
  });
</script>

<style>
  /* Additional styling for blog content */
  .prose {
    color: #f8f8f8;
  }
  
  .prose a {
    color: var(--color-primary, #38bdf8);
    text-decoration: none;
  }
  
  .prose a:hover {
    text-decoration: underline;
  }
  
  .prose img {
    border-radius: 0.5rem;
    margin: 1.5rem 0;
  }
  
  .prose code {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 0.25rem;
    padding: 0.125rem 0.25rem;
  }
</style>